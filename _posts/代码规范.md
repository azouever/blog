---

title: 写好代码

date: 2021-04-06 09:45:08

---

![goodCodeOrBadCode](https://azou.tech/blog/static/image/wtfperminute.jpeg)

> 尽量让工具自动化来保证，人总是会出错误
> 编码阶段（清除带有坏味道的代码）->单元测试->静态工具检查->
> 重构是时刻进行的
> 良好的单测才是重构的保证
> 
>如何将一个这个规约串起来的，就从一个空项目开始，从项目结构建议开始，到编写代码这样的一个流程，将所有的规范在这个过程中说明。
> 
>对于一个项目来说，：**保持一致性**，不管是哪种风格，一致性，一致性，一致性，自己保持一致性相对容易，项目中就要和项目保持一致，项目有一致的风格，那就适当牺牲自己的偏好。

### 包含内容
- 编码规约
  - 命名
  - 代码风格
  - 关于注释
  - 前后端约定
- 业务处理
  - 业务参数校验
  - orm层框架统一处理
- 单元测试
- 重构内容
- effective java

### 编码规约
> 尽量给阅读的人一种如沐春风，赏心悦目的感觉。
#### 命名

> 取一个特别合适的名字是一件非常有挑战的事情

大到项目名、模块名、包名、对外暴露的接口，小到类名、函数名、变量名、参数名，只要是做开发，我们就逃不过“起名字”这一关。命名的好坏，对于代码的可读性来说非常重要，甚至可以说是起决定性作用的。除此之外，命名能力也体现了一个程序员的基本编程素养。

想要起一个能准确达意的名字，没有足够的积累，确实挺费劲。

实际上，命名这件事说难也不难，对于影响范围比较大的命名，比如包名、接口、类名，我们一定要反复斟酌、推敲。可以去 GitHub 上用相关的关键词联想搜索一下，看看类似的代码是怎么命名的。或者经常看看别人写的代码，慢慢就会有自己的词库。

##### 命名之道

> 命名的时候，我们一定要学会换位思考，假设自己不熟悉这块代码，从代码阅读者的角度去考量命名是否足够直观。

1. 项目module命名，结合[COLA](https://github.com/alibaba/COLA)尽量保持统一风格

   ![adaptorName](https://azou.tech/blog/static/image/adaptor_module_name_different.png)

2. 包名统一使用小写。包名统一使用 单数形式，但是类名如果有复数含义，类名可以使用复数形式。例：util包，StringUtils类；

3. 命名风格

   1) 类名使用UpperCamelCase风格，但以下情形例外:DO/BO/DTO/VO/AO/ PO / UID 等。

   2) 方法名、参数名、成员变量、局部变量都统一使用lowerCamelCase风格

4. 命名的长和短

   长的命名可以包含更多的信息，更能准确直观地表达意图，但是，如果函数、变量的命名很长，那由它们组成的语句就会很长。在代码列长度有限制的情况下，就会经常出现一条语句被分割成两行的情况，这其实会影响代码可读性。

   实际上，在足够表达其含义的情况下，命名当然是越短越好。但是，大部分情况下，短的命名都没有长的命名更能达意。所以，很多书籍或者文章都不推荐在命名时使用缩写。

   对于一些默认的、大家都比较熟知的词，比较推荐用缩写。这样一方面能让命名短一些，另一方面又不影响阅读理解，比如，sec 表示 second、str 表示 string、num 表示 number、doc 表示 document。

   除此之外，**对于作用域比较小的变量，我们可以使用相对短的命名，比如一些函数内的临时变量。相反，对于类名这种作用域比较大的，更推荐用长的命名方式**。

5. 增删改查动作命名

   1) 获取单个对象的方法用 get 做前缀。

   2) 获取多个对象的方法用 list 做前缀，复数结尾，如:listObjects。

   3) 获取统计值的方法用 count 做前缀。

   4) 插入的方法用 save/insert 做前缀。

   5) 删除的方法用 remove/delete 做前缀。

   6) 修改的方法用 update 做前缀。

   7) 分页的方法用 page 做前缀。

6. 分层领域对象命名

   1) 数据对象:xxxDO，xxx 即为数据表名。DO（ Data Object）

   2) 数据传输对象:xxxDTO，xxx 为业务领域相关的名称。DTO（ Data Transfer Object）

   3) 展示对象:xxxVO，xxx 一般为网页名称。VO（ View Object）

   4) POJO 是 DO/DTO/BO/VO 的统称，禁止命名成 xxxPOJO。POJO（ Plain Ordinary Java Object）

7. POJO类中的任何布尔类型的变量，建议都不要加is前缀，否则部分框架解析会引起序列化错误。

8. 接口类中的方法和属性不要加任何修饰符号(public 也不要加)，保持代码的简洁性，并加上有效的 Javadoc 注释。尽量不要在接口里定义变量，如果一定要定义变量，确定与接口方法相关，并且是整个应用的基础常量。

9. 常量命名全部大写，单词间用下划线隔开，力求语义表达完整清楚，不要嫌名字长。


#### 代码风格

> 在团队、项目中保持风格统一，让代码像同一个人写出来的，整齐划一。这样能减少阅读干扰，提高代码的可读性。这才是我们在实际工作中想要实现的目标。

1. 避免巨大的类，职责分明

2. 避免巨大的方法，单个方法的总行数不超过 80 行

3. 避免过多的参数，如果参数过多，则封装成对象

4. 善用空行分割单元块

   对于比较长的函数，如果逻辑上可以分为几个独立的代码块，在不方便将这些独立的代码块抽取成小函数的情况下，为了让逻辑更加清晰，可以用总结性注释的方法之外，我们还可以使用空行来分割各个代码块。

   除此之外，在类的成员变量与函数之间、静态成员变量与普通成员变量之间、各函数之间、甚至各成员变量之间，我们都可以通过添加空行的方式，让这些不同模块的代码之间，界限更加明确。写代码就类似写文章，善于应用空行，可以让代码的整体结构看起来更加有清晰、有条理。

5. 类中成员的排列顺序

   在类中，成员变量排在函数的前面。成员变量之间或函数之间，都是按照“先静态（静态函数或静态成员变量）、后普通（非静态函数或非静态成员变量）”的方式来排列的。

   除此之外，成员变量之间或函数之间，还会按照作用域范围从大到小的顺序来排列，先写 public 成员变量或函数，然后是 protected 的，最后是 private 的。

   实际上，还有另外一种排列习惯，那就是把有调用关系的函数放到一块。比如，一个 public 函数调用了另外一个 private 函数，那就把这两者放到一块。

6. **IDE 的 text file encoding 设置为 UTF-8; IDE 中文件的换行符使用 Unix 格式**

**统一codeStyle**：https://github.com/google/styleguide/blob/gh-pages/intellij-java-google-style.xml

统一checkStyle: https://www.jianshu.com/p/0c917f4cac1e;https://checkstyle.sourceforge.io/

#### 代码注释

> 注释的目的就是让代码更容易看懂。只要符合这个要求的内容，你就可以将它写到注释里。总结一下，注释的内容主要包含这样三个方面：做什么、为什么、怎么做。

1. 函数和变量如果命名得好，确实可以不用再在注释中解释它是做什么的。对于有些比较复杂的类或者接口，我们可能还需要在注释中写清楚“如何用”;
2. 对于逻辑比较复杂的代码或者比较长的函数，如果不好提炼、不好拆分成小的函数调用，那我们可以借助总结性的注释来让代码结构更清晰、更有条理。
3. 注释太多和太少的问题，类和函数一定要写注释，而且要写得尽可能全面、详细，而函数内部的注释要相对少一些，一般都是靠好的命名、提炼函数、解释性变量、总结性注释来提高代码的可读性。
4. 代码修改的同时，注释也要进行相应的修改，尤其是参数、返回值、异常、核心逻辑 等的修改。
5. 在类中删除未使用的任何字段、方法、内部类;在方法中删除未使用的任何参数声明 与内部变量
6. 谨慎注释掉代码。在上方详细说明，**而不是简单地注释掉。如果无用，则删除。** 说明:代码被注释掉有两种可能性:1)后续会恢复此段代码逻辑。2)永久不用。前者如果没有备注信息， 难以知晓注释动机。后者建议直接删掉即可，假如需要查阅历史代码，登录代码仓库即可。

#### 前后端规约

1. URL 路径不能使用大写，单词如果需要分隔，统一使用下划线

2. 路径禁止携带表示请求内容类型的后缀，比如".json",".xml"，通过 accept 头表达即可

3. 在前后端交互的 JSON 格式数据中，所有的 key 必须为小写字母开始的 lowerCamelCase 风格，符合英文表达习惯，且表意完整

4. 对于需要使用超大整数的场景，服务端一律使用 String 字符串类型返回，禁止使用 Long 类型。

5. HTTP请求通过URL传递参数时，不能超过2048字节

6. HTTP 请求通过 body 传递内容时，必须控制长度，超出最大长度后，后端解析会出错。

   说明:nginx 默认限制是 1MB，tomcat 默认限制为 2MB，当确实有业务需要传较大内容时，可以通过调

   大服务器端的限制。

7. 在翻页场景中，用户输入参数的小于 1，则前端返回第一页参数给后端;后端发现用户输入的参数大于总页数，直接返回最后一页


### 不同的问题如何处理

1. 
2. 
5. 统一的代码风格
6. 单元测试
7. gitlab 集成工具来处理


### 使用统一的项目结构

> 请求，参数转换，校验逻辑，业务逻辑处理[和中间件的交互，和数据库的交互，和外部服务的交互]，统一定义好交互层的处理，做到项目都使用统一的结构

### 单元测试

1. 好的单元测试必须遵守 AIR 原则。单元测试在线上运行时，感觉像空气(AIR)一样感觉不到，但在测试质量的保障上，却是非常关键的。好的单元测试宏观上来说，具有自动化、独立性、可重复执行的特点。
2. 单元测试是可以重复执行的，不能受到外界环境的影响。使用Mock工具。
3. 对于单元测试，要保证测试粒度足够小，有助于精确定位问题。单测粒度至多是类级别，一般是方法级别。 
4. 核心业务、核心应用、核心模块的增量代码确保单元测试通过。
5. 保持单元测试的独立性。为了保证单元测试稳定可靠且便于维护，单元测试用例之间 决不能互相调用，也不能依赖执行的先后次序。
6. 为了更方便地进行单元测试，业务代码应避免以下情况:
   1. 构造方法中做的事情过多。
   2. 存在过多的全局变量和静态方法。
   3. 存在过多的外部依赖。
   4. 存在过多的条件语句。
   5. 多层条件语句建议使用[卫语句](https://juejin.cn/post/6844903764336312333)、策略模式、状态模式等方式重构

### 重构
> 重构时刻在进行

#### 代码中的坏味道

### effective java
> 

### 工具使用

> 静态工具分析

ali-check

sonarlint


### 相关介绍


### 参考
- [Google Java Style Guide](https://google.github.io/styleguide/javaguide.html)
- [阿里代码规约](https://github.com/alibaba/p3c)
- [重构](https://www.infoq.cn/article/clean-code-refactor)
- [effective-java-3rd](https://medium.com/@wizardforcel/java-%E9%AB%98%E6%95%88%E7%BC%96%E7%A8%8B-effective-java-%E4%B8%AD%E6%96%87%E7%AC%AC%E4%B8%89%E7%89%88-7d478810dccb)
- [最快速地改善代码质量的20条编程规范](https://www.cnblogs.com/wwj99/p/12766167.html)
- [API设计指南](https://www.v2ex.com/t/693907)

