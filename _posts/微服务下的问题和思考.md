---
title: 微服务下的问题和思考
date: 2020-09-02 21:58:13
---

#####  问题点

1. 快速定位服务故障点比较费劲，是哪个服务的问题，多服务，并且每个服务多个节点集群部署。在我们系统里面，我作为门户，但是后面包着账户中心，支付中心，用户中心等。每次一出现问题，然后都找我们，说是我们的问题，但是大部分情况下都和我们没有关系，但是我们都要协查，就比较费时耗力。我们的做法是：首先我们要比客户早知道问题，定时查询异常单据进行预警，然后发邮件，发企业微信，通知相关人员给予解决，这个确实是一个很蛮不错的东西，不能从根源上把问题解决了，那我们就及时的发现问题。那个是通知到各个系统，还是没有全局关联起来，后来想用一个全局的traceId把业务关联起来，其实就是全链路追踪。需要多个部分大家都参与，结果就是没有做完，如果做完了对于问题定位应该会很快。
2. 雪崩效应，可能一个服务不可用了，然后其他依赖该服务的也变得不可用，就像我上面描述的，可以账户呀，你不能提供服务了就是不能了，你怎么容错降级呢，那可是账呀。
3. 稳定性下降，服务点多了以后出现故障的几率那肯定是增大的。
4. 部署，管理多个节点就比较麻烦了。

##### 解决办法
1. 监控系统，监控什么内容，中间件内存，网络流量，数据库连接，业务系统里面的某些参数值等等，然后使用一个收集器定时从对应的接口里面获取这个数据，然后提供查询和dashBoard进行查看，同时进行发送邮件通知
2. 链路追踪，traceId[一个请求id]，spanId[每个服务节点id]，请求和响应时间，这样可以快速知道是哪里出了问题。
3. 日志分析，知道哪里出现了问题后，就去查看日志问题究竟是什么。使用ELK快速的把问题找出来，不过先在容器化后好像有许多别的日志分析框架
4. 内部的服务治理，进行动态扩容
5. 熔断机制，当多次访问一个服务失败时，应熔断，标记该服务已停止工作，直接返回错误。通过健康检查，直至该服务恢复正常后再重新建立连接。
6. 服务降级，把一些非核心业务可以暂时关闭掉，不能影响核心业务流程
7. 限流保护，但是目前为止我们的系统还不需要这个，虽然业务上流量也不少，巴不得人家来访问我们呢，还没有到一下打死的地步。

##### Service Mesh

##### 容器化编排 
1. docker
2. k8s







```lua
-- 配合各种Escape Sequence
string.rep('hahaha\t', 10)
```
##### 相关介绍





##### 参考
- https://www.cnblogs.com/tsingke/p/10853936.html


