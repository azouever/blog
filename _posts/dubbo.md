---

title: Dubbo学习和对于RPC的理解

date: 2020-09-18 15:42:17

---

##### 什么是RPC

> Remote Procedure Call 远程过程调用，就是一种通过网络从远程计算机程序上请求服务，而不需要了解底层网络技术的协议。满足分布式系统架构中不同的系统之间的远程通信和相互调用

- 从通信协议来看可以分为：
基于HTTP协议：Rest（Json）、Hession（binary）；
基于TCP协议（以Netty高性能网络框架，然后使用自己实现的高效率应用协议）。
 
- 从语言和平台理解：
 仅支持特定语言： Java的RMI；
 可以跨平台：HTTP Rest、Thrift。
 
- 从调用过程来看
 同步调用;
 异步调用。
 
- 不同的序列化协议
 序列化：将对象转成二进制流;
 反序列化：将二进制流转换成对象。
 使用不同的序列化框架对RPC的性能有影响,所以要选择高效率的序列化框架，考虑速度，空间，能否跨语言
 
- 网络协议，网络模型，线程模型
 
- RPC安全服务接口的鉴权和访问控制
 
- 常见的RPC框架：
> 
> Dubbo alibaba Java
> 
> Motan weibo Java
> 
> Tars tencent C++
> 
> gRPC google multi language
> 
> Thrift facebook multi language
> 
> Spring Cloud 全套的微服务下的服务治理方案
> 

##### 架构

- Provider
- Consumer 从提供者地址列表中，基于软负载均衡算法，选一台提供者进行调用，如果调用失败，再选另一台调用。
- Registry 服务注册与发现的注册中心，注册中心返回服务提供者地址列表给消费者，如果有变更，注册中心将基于长连接推送变更数据给消费者；负责服务地址的注册与查找，相当于目录服务，服务提供者和消费者只在启动时与注册中心交互，注册中心不转发请求，压力较小。
- Monitor 统计服务的调用次数和调用时间的监控中心，异步
- Container

> 连通性 注册中心，服务提供者，服务消费者三者之间均为长连接，监控中心除外
> 
> 健壮性  注册中心和监控中心全部宕机，不影响已运行的提供者和消费者，消费者在本地缓存了提供者列表
> 注册中心和监控中心都是可选的，服务消费者可以直连服务提供者
> 
> 伸缩性
> 注册中心为对等集群，可动态增加机器部署实例，所有客户端将自动发现新的注册中心
服务提供者无状态，可动态增加机器部署实例，注册中心将推送新的服务提供者信息给消费者

##### 源码结构模块

> 写在前面
> 
> dubbo的基本设计原则是采用URL作为配置信息的统一格式，所有拓展点都通过传递URL携带配置信息。

###### 注册中心模块

> dubbo的注册中心实现有Multicast、Zookeeper、Redis、Nacos、Consul、Etcd、Eureka、Sofa、Simple，这个模块就是封装了dubbo所支持的注册中心的实现。官方推荐Zookeeper。

###### 集群模块
> 将多个服务提供方伪装为一个提供方，包括：负载均衡, 容错，路由等，集群的地址列表可以是静态配置的，也可以是由注册中心下发。

###### 公共逻辑模块
> 包括 Util 类和通用模型
> 

###### 配置模块
> Dubbo对外的 API，用户通过 Config 使用Dubbo，隐藏 Dubbo 所有细节。用户都是使用配置来使用dubbo，dubbo也提供了四种配置方式，包括XML配置、属性配置、API配置、注解配置，配置模块就是实现了这四种配置的功能。
> 

###### 远程调用模块
> 抽象各种协议，以及动态代理，只包含一对一的调用，不关心集群的管理。远程调用，最主要的肯定是协议，dubbo提供了许许多多的协议实现，不过官方推荐时使用dubbo自己的协议，还给出了一份性能测试报告。这个模块依赖于dubbo-remoting模块，抽象了各类的协议
> 

###### 远程通信模块
> 相当于 Dubbo 协议的实现，如果 RPC 用 RMI协议则不需要使用此包。提供了多种客户端和服务端通信功能，比如基于Grizzly、Netty、Etcd3、Http、Mina等等，RPC用除了RMI的协议都要用到此模块。
> 

###### 容器模块
>  因为后台服务不需要Tomcat/JBoss 等 Web 容器的功能，不需要用这些厚实的容器去加载服务提供方，既资源浪费，又增加复杂度。服务容器只是一个简单的Main方法，加载一些内置的容器，也支持扩展容器。
> 

###### 监控模块
>  统计服务调用次数，调用时间的，调用链跟踪的服务。这个模块很清楚，就是对服务的监控。
> 

###### 过滤器模块
> 内置的一些过滤器：提供缓存过滤器。提供参数验证过滤器。
> 

###### 插件模块
>  内置的插件：提供了在线运维的命令。
> 

###### 序列化模块
>  封装了各类序列化框架的支持实现。序列化也支持扩展。
> 

##### 好玩的
```lua
-- 配合各种Escape Sequence
string.rep('hahaha\t', 10)
```
##### 相关介绍




##### 参考
- https://dubbo.apache.org/zh-cn/docs/user/quick-start.html
- https://segmentfault.com/a/1190000016741532

